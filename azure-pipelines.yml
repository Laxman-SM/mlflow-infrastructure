# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- master

pool:
  vmImage: 'ubuntu-latest'

variables:
- name: HELM_EXPERIMENTAL_OCI
  value: 1 

steps:
- task: HelmInstaller@0
  inputs:
    helmVersion: '2.14.1'
    installKubectl: true
- task: AWSShellScript@1
  inputs:
    awsCredentials: 'ECR Push'
    regionName: 'eu-central-1'
    scriptType: 'inline'
    inlineScript: |
      set -e
      echo "will this work?"
      echo $(helm version)
      helm chart save mlflow-chart/ mlflow
      helm chart save mlflow-chart/ 579478677147.dkr.ecr.eu-central-1.amazonaws.com/dna/mlflow:mlflow